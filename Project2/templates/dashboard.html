{% include 'header.html' %}
{% block content %}

<div class="max-w-4xl mx-auto p-8 bg-white shadow-lg rounded-lg mt-10">
  <div class="text-center mb-6">
    <div class="relative inline-block mb-4">
      {% if profile_owner.userprofile.profile_picture %}
        <img id="profile-img-preview" 
             src="{{ profile_owner.userprofile.profile_picture.url }}" 
             alt="Profile Picture" 
             class="w-32 h-32 rounded-full border-4 border-indigo-500 shadow-lg">
      {% else %}
        <img id="profile-img-preview" 
             src="https://via.placeholder.com/150" 
             alt="Profile Picture" 
             class="w-32 h-32 rounded-full border-4 border-indigo-500 shadow-lg">
      {% endif %}
    </div>

    <h2 class="text-2xl font-semibold text-gray-800">{{ profile_owner.username }}</h2>
    <p class="text-gray-500">{{ profile_owner.first_name }} {{ profile_owner.last_name }}</p>

    <div class="bio mt-4">
      <p id="bio-display" class="text-gray-600">{{ profile_owner.userprofile.bio }}</p>
    </div>
    
    <div class="location mt-4">
      <p id="location-display" class="text-gray-600">{{ profile_owner.userprofile.location }}</p>
    </div>

    {% if is_owner %}
      <button id="toggleEditBtn" onclick="toggleEditForm()" class="mt-6 py-3 px-6 bg-indigo-600 text-white rounded-md shadow-md hover:bg-indigo-700 transition duration-300">
        Edit Profile
      </button>

      <div id="editForm" class="hidden mt-6">
        <form method="POST" action="{% url 'dashboard' profile_owner.username %}" enctype="multipart/form-data">
          {% csrf_token %}
          
          <div class="mt-6">
            <label for="bio" class="block text-gray-600">Bio</label>
            <textarea name="bio" id="bio" class="w-full p-3 mt-2 border border-gray-300 rounded-md" rows="4">{{ profile_owner.userprofile.bio }}</textarea>
          </div>

          <div class="mt-6">
            <label for="location" class="block text-gray-600">Location</label>
            <input type="text" name="location" id="location" class="w-full p-3 mt-2 border border-gray-300 rounded-md" value="{{ profile_owner.userprofile.location }}">
          </div>

          <div class="mt-6">
            <label for="profile_picture" class="block text-gray-600">Profile Picture</label>
            <input type="file" name="profile_picture" id="profile_picture" class="w-full p-3 mt-2 border border-gray-300 rounded-md">
          </div>

          <button type="submit" class="mt-6 py-3 px-6 bg-indigo-600 text-white rounded-md shadow-md hover:bg-indigo-700 transition duration-300">
            Save Changes
          </button>
        </form>
      </div>
    {% endif %}
  </div>
</div>

<!-- Post Creation Section (only visible if user is a member) -->

{% if profile_owner.userprofile.is_memeber %}
  <div class="max-w-4xl mx-auto mt-10 p-8 bg-white shadow-lg rounded-lg">
    <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Create a New Post</h2>
    
    <div class="flex justify-center">
      <button onclick="showPostModal()" action="{% url 'dashboard' profile_owner.username %}" name="create_post" class="text-center flex items-center py-3 px-6 bg-indigo-600 text-white rounded-md shadow-md hover:bg-indigo-700 transition duration-300">
        <i class="fas fa-plus mr-2"></i>Create Post
      </button>
    </div>
  </div>
{% else %}
  <div class="max-w-4xl mx-auto mt-10 p-8 bg-white shadow-lg rounded-lg">
    <p class="text-center text-gray-500">You need to be a member to create a post. <a href="{% url 'payment' %}" class="text-indigo-600">Click here</a> to make a payment.</p>
  </div>
{% endif %}

<!-- Modal for Post Creation -->

<div id="postModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white p-8 rounded-lg shadow-lg w-96">
    <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Create a New Post</h2>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}
      <div class="mt-6">
        <label for="title" class="block text-gray-600">Post Title</label>
        <input type="text" name="title" id="title" class="w-full p-3 mt-2 border border-gray-300 rounded-md" placeholder="Enter title" required>
      </div>
      
      <div class="mt-6">
        <label for="photo" class="block text-gray-600">Post File</label>
        <input type="file" name="photo" id="photo" class="w-full p-3 mt-2 border border-gray-300 rounded-md" required>
      </div>
      
      <!-- Center the button properly here -->
      
        <button type="submit" name="create_post" class="py-3 px-6 bg-indigo-600 text-white rounded-md shadow-md hover:bg-indigo-700 transition duration-300">
          Create Post
        </button>
      

            <button type="button" onclick="hidePostModal()" class="mt-3 py-3 px-6 bg-red-600 text-white rounded-md shadow-md hover:bg-red-700 transition duration-300">
          Cancel
        </button>
         </form>
  </div>
</div>

<!-- Display User's Posts -->
<div class="max-w-4xl mx-auto mt-10 p-8 bg-white shadow-lg rounded-lg">
  <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Your Posts</h2>
  
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    {% for post in posts %}
      {% if post.account == request.user %}
        <a href="{% url 'view_post' slug=post.slug username=post.account.username %}">
          <div class="group rounded-lg overflow-hidden shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
            <div class="relative h-80 overflow-hidden">
              <img src="{{ post.photo.url }}" alt="Post Image" class="w-full h-full object-cover">
              <div class="absolute inset-0 bg-black bg-opacity-40 flex justify-center items-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <div class="text-white flex items-center gap-2">
                  <div class="flex items-center">
                    <i class="fas fa-heart text-2xl mr-1"></i>
                    <span class="text-sm">{{ post.like_count }}</span>
                  </div>
                  <div class="flex items-center"> 
                    <i class="fas fa-comment text-2xl mr-1"></i>
                    <span class="text-sm">{{ post.get_comment_count }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </a>
      {% endif %}
    {% empty %}
      <p class="text-center text-gray-500 col-span-3">No posts yet.</p>
    {% endfor %}
  </div>
</div>

<script>
  // Show modal and disable body scroll
  function showPostModal() {
    document.getElementById("postModal").classList.remove("hidden");
    document.body.classList.add("no-scroll");  // Disable body scroll
  }

  // Hide modal and enable body scroll
  function hidePostModal() {
    document.getElementById("postModal").classList.add("hidden");
    document.body.classList.remove("no-scroll");  // Enable body scroll
  }

  // Toggle edit profile form visibility
  function toggleEditForm() {
    var formDiv = document.getElementById("editForm");
    formDiv.classList.toggle("hidden");
  }
</script>

<style>
  /* Disable scrolling */
  .no-scroll {
    overflow: hidden;
  }
</style>

{% endblock %}

